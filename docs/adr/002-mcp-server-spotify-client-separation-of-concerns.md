# MCP Server と Spotify Client 初期化の責務分離

## ステータス
検討中

## コンテキスト
Spotify MCP サーバーの実装において、Spotify SDK クライアントの初期化をどこで行うべきかを決定する必要がある。

### 現在の課題
`createMCPServer` 関数内で Spotify クライアントを初期化する場合、以下の問題が発生する：

1. **責務の混在**
   - MCPサーバーの責務：MCPプロトコルの実装、ツールの登録・管理
   - Spotifyクライアントの責務：Spotify APIの認証、API通信
   - これらが混在することで単一責任の原則に違反

2. **テストの複雑化**
   - MCPサーバーのテストでSpotify SDKのモックが必要
   - 認証ロジックのモックにより、テストが本質的でない部分に依存

3. **再利用性の低下**
   - 異なる認証方式（Client Credentials、Authorization Code with PKCE）への対応が困難
   - 複数のMCPサーバーインスタンス間でクライアントを共有できない

4. **エラーハンドリングの複雑化**
   - クライアント初期化の失敗がMCPサーバー作成の失敗になる
   - 認証エラーとMCPプロトコルエラーの境界が曖昧

5. **設定の硬直性**
   - 環境別の設定（開発/本番）が複雑になる
   - 動的な認証情報の更新が困難

6. **依存関係の増加**
   - `mcp.ts` が `@spotify/web-api-ts-sdk` に直接依存
   - Spotify SDK の更新が MCP サーバーの実装に影響

## 決定
（保留中）

## 理由
MCPサーバーの責務を明確に保ち、テスタビリティと拡張性を確保するため、Spotify クライアントの初期化は MCP サーバーの外部で行うべきである。

具体的な実装方法については引き続き検討が必要。

## 結果
責務分離により以下が期待される：
- MCP サーバーの責務が明確になる
- テストが簡潔になる
- 異なる認証方式への対応が容易になる
- エラーハンドリングが明確になる